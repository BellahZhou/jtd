<?xml version="1.0" encoding="UTF-8"?>
<b:beans
        xmlns="http://www.springframework.org/schema/security"
        xmlns:b="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.springframework.org/schema/beans
	http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
	http://www.springframework.org/schema/security
	http://www.springframework.org/schema/security/spring-security-3.2.xsd">
<!--多个过滤器  -->
    <http security="none" pattern="/**/*.js"/>
    <http security="none" pattern="/**/*.gif"/>
    <http security="none" pattern="/**/*.css"/>
    <http security="none" pattern="/**/*.jpg"/>
    <http security="none" pattern="/**/*.png"/>

    <http security="none" pattern="/common/**"/>
    <http security="none" pattern="/serviceValidate"/>

    <http auto-config="true" use-expressions="true"
          entry-point-ref="myLoginUrlAuthenticationEntryPoint" access-denied-page="/WEB-INF/view/403.jsp">

        
 		<form-login login-page="/login.jsp" authentication-failure-url="/login.jsp" />


        <intercept-url pattern="/**" access="authenticated"/>

        <logout invalidate-session="true" logout-success-url="/index" logout-url="/logout"/>

        <session-management  invalid-session-url="/login">
            <concurrency-control  max-sessions="1" expired-url="/login" error-if-maximum-exceeded="false"/>
        </session-management>

        <custom-filter ref="myFilter" before="FILTER_SECURITY_INTERCEPTOR"/>

    </http>
<!-- 自定义过滤器（filterChain在后） -->
    <b:bean id="myFilter" class="com.jtd.web.security.MyFilterSecurityInterceptor">
        <b:property name="authenticationManager" ref="authenticationManager"/>
        <b:property name="accessDecisionManager" ref="myAccessDecisionManager"/>
        <b:property name="securityMetadataSource" ref="securityMetadataSource"/>
    </b:bean>
    
    <b:bean id="myLoginUrlAuthenticationEntryPoint"
                class="com.jtd.web.security.MyLoginUrlAuthenticationEntryPoint">
        <b:constructor-arg name="loginFormUrl" value="/login.jsp"></b:constructor-arg>
    </b:bean>
    
    <b:bean id="simpleUrlAuthenticationSuccessHandler" class="org.springframework.security.web.authentication.SimpleUrlAuthenticationSuccessHandler">
        <b:property name="defaultTargetUrl" value="/index"></b:property>
        <b:property name="redirectStrategy" ref="keepParamRedirectStrategy"></b:property>
    </b:bean>
    
    <b:bean id="simpleUrlAuthenticationFailureHandler"
            class="org.springframework.security.web.authentication.SimpleUrlAuthenticationFailureHandler">
        <b:property name="defaultFailureUrl" value="/login.jsp"></b:property>
        <b:property name="redirectStrategy" ref="keepParamRedirectStrategy"></b:property>
    </b:bean>
    <!-- 1 -->
  	<authentication-manager erase-credentials="false" alias="authenticationManager">
        <authentication-provider ref="authenticationProvider"></authentication-provider>
    </authentication-manager>
    <b:bean id="myAccessDecisionManager"
            class="com.jtd.web.security.MyAccessDecisionManager">
    </b:bean>
    <b:bean id="securityMetadataSource"
            class="com.jtd.web.security.MyInvocationSecurityMetadataSource">
    </b:bean>
    
    <b:bean id="keepParamRedirectStrategy" class="com.jtd.web.security.KeepParamRedirectStrategy"/>
    
    <!--1.1  -->
    <b:bean id="authenticationProvider" class="com.jtd.web.security.CustomAuthenticationProvider">
        <b:property name="userDetailsService" ref="myUserDetailService"/>
        <b:property name="hideUserNotFoundExceptions" value="false"/>
        <b:property name="passwordEncoder" ref="passwordEncoder"></b:property>
        <b:property name="messageSource" ref="messageSource"></b:property>
    </b:bean>
    
    
    <!--1.1.1  -->
	<b:bean id="myUserDetailService" class="com.jtd.web.security.MyUserDetailService"/>
    <!-- 对密码进行MD5编码 -->
    <b:bean class="com.jtd.util.Md5PasswordEncoder" id="passwordEncoder"/>
    
</b:beans>